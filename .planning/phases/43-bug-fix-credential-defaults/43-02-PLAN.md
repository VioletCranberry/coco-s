---
phase: 43-bug-fix-credential-defaults
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - docker-compose.yml
  - dev-setup.sh
  - .env.example
  - README.md
  - docs/mcp-configuration.md
autonomous: true

must_haves:
  truths:
    - "docker compose up starts PostgreSQL with cocosearch:cocosearch credentials"
    - "All documentation and scripts reference cocosearch:cocosearch credentials, not cocoindex:cocoindex"
    - ".env.example shows the new default URL with cocosearch credentials"
    - "dev-setup.sh exports the correct COCOSEARCH_DATABASE_URL with cocosearch credentials"
  artifacts:
    - path: "docker-compose.yml"
      provides: "PostgreSQL service with cocosearch:cocosearch credentials"
      contains: "POSTGRES_USER: cocosearch"
    - path: "dev-setup.sh"
      provides: "Setup script with correct database URL"
      contains: "cocosearch:cocosearch"
    - path: ".env.example"
      provides: "Example env file with new default URL"
      contains: "cocosearch:cocosearch"
    - path: "README.md"
      provides: "Updated quick start with new credentials"
      contains: "cocosearch:cocosearch"
    - path: "docs/mcp-configuration.md"
      provides: "MCP config docs with correct database URLs"
      contains: "cocosearch:cocosearch"
  key_links:
    - from: "docker-compose.yml"
      to: "src/cocosearch/config/env_validation.py"
      via: "Credentials match DEFAULT_DATABASE_URL"
      pattern: "cocosearch:cocosearch@localhost:5432/cocosearch"
---

<objective>
Align all infrastructure files and documentation to use cocosearch:cocosearch credentials consistently.

Purpose: Eliminate the credential mismatch between docker-compose.yml (cocoindex:cocoindex) and the application default (cocosearch:cocosearch). After this change, `docker compose up` creates a database that matches the application's default DATABASE_URL.

Output: All infra files and docs use `cocosearch:cocosearch` credentials. Zero references to `cocoindex:cocoindex` remain in non-planning files.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/43-bug-fix-credential-defaults/43-RESEARCH.md
@docker-compose.yml
@dev-setup.sh
@.env.example
@README.md
@docs/mcp-configuration.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Update docker-compose.yml and dev-setup.sh credentials</name>
  <files>
    docker-compose.yml
    dev-setup.sh
  </files>
  <action>
    **INFRA-02: Update docker-compose.yml**

    Replace all 4 occurrences of `cocoindex` with `cocosearch` in the db service:

    Line 8: `POSTGRES_USER: cocoindex` -> `POSTGRES_USER: cocosearch`
    Line 9: `POSTGRES_PASSWORD: cocoindex` -> `POSTGRES_PASSWORD: cocosearch`
    Line 10: `POSTGRES_DB: cocoindex` -> `POSTGRES_DB: cocosearch`
    Line 14: `pg_isready -U cocoindex -d cocoindex` -> `pg_isready -U cocosearch -d cocosearch`

    Do NOT change anything in the ollama service.

    **Update dev-setup.sh**

    Line 9: Change the export from:
    ```bash
    export COCOSEARCH_DATABASE_URL="postgresql://cocoindex:cocoindex@localhost:5432/cocoindex"
    ```
    to:
    ```bash
    export COCOSEARCH_DATABASE_URL="postgresql://cocosearch:cocosearch@localhost:5432/cocosearch"
    ```

    Line 117: Change the echo from:
    ```bash
    echo "  export COCOSEARCH_DATABASE_URL=\"postgresql://cocoindex:cocoindex@localhost:5432/cocoindex\""
    ```
    to:
    ```bash
    echo "  export COCOSEARCH_DATABASE_URL=\"postgresql://cocosearch:cocosearch@localhost:5432/cocosearch\""
    ```

    Additionally, update the "next steps" section in dev-setup.sh. Since DATABASE_URL now has a default, the instruction to set it in shell rc is no longer required. Update lines 114-117 from:
    ```bash
    echo "Set this in your shell (add to ~/.bashrc or ~/.zshrc for persistence):"
    echo ""
    echo "  export COCOSEARCH_DATABASE_URL=\"postgresql://cocosearch:cocosearch@localhost:5432/cocosearch\""
    ```
    to:
    ```bash
    echo "DATABASE_URL defaults to postgresql://cocosearch:cocosearch@localhost:5432/cocosearch"
    echo "No environment variable needed when using docker compose."
    echo ""
    echo "To override (add to ~/.bashrc or ~/.zshrc):"
    echo "  export COCOSEARCH_DATABASE_URL=\"postgresql://custom:pass@host:5432/db\""
    ```
  </action>
  <verify>
    Run: `grep -n 'cocoindex' docker-compose.yml`
    Expected: No output (zero occurrences remain).

    Run: `grep -n 'cocoindex' dev-setup.sh`
    Expected: No output (zero occurrences remain).

    Run: `grep -c 'cocosearch' docker-compose.yml`
    Expected: 4 (POSTGRES_USER, POSTGRES_PASSWORD, POSTGRES_DB, pg_isready).
  </verify>
  <done>
    - docker-compose.yml uses cocosearch:cocosearch credentials everywhere (INFRA-02 complete)
    - dev-setup.sh exports correct DATABASE_URL with cocosearch credentials
    - dev-setup.sh next-steps message updated to reflect that env var is now optional
    - Zero references to cocoindex:cocoindex remain in either file
  </done>
</task>

<task type="auto">
  <name>Task 2: Update .env.example, README, and MCP configuration docs</name>
  <files>
    .env.example
    README.md
    docs/mcp-configuration.md
  </files>
  <action>
    **Update .env.example**

    Line 10: Change from:
    ```
    COCOSEARCH_DATABASE_URL=postgresql://cocoindex:cocoindex@localhost:5432/cocoindex
    ```
    to:
    ```
    COCOSEARCH_DATABASE_URL=postgresql://cocosearch:cocosearch@localhost:5432/cocosearch
    ```

    Also update the "Required" section header comment. Since DATABASE_URL now has a default, change:
    ```
    # =============================================================================
    # Required
    # =============================================================================

    # PostgreSQL connection URL for vector storage
    # Format: postgresql://user:password@host:port/database
    ```
    to:
    ```
    # =============================================================================
    # Optional (has default: postgresql://cocosearch:cocosearch@localhost:5432/cocosearch)
    # =============================================================================

    # PostgreSQL connection URL for vector storage (uncomment to override default)
    # Format: postgresql://user:password@host:port/database
    ```

    And comment out the value since it is now optional:
    ```
    # COCOSEARCH_DATABASE_URL=postgresql://cocosearch:cocosearch@localhost:5432/cocosearch
    ```

    **Update README.md**

    Line 70: Change from:
    ```
    export COCOSEARCH_DATABASE_URL="postgresql://cocoindex:cocoindex@localhost:5432/cocoindex"
    ```
    to:
    ```
    export COCOSEARCH_DATABASE_URL="postgresql://cocosearch:cocosearch@localhost:5432/cocosearch"
    ```

    Note: The README may need additional context adjustment -- if the surrounding text says "set this required variable", update to note it's optional when using docker compose defaults. Read the surrounding lines (65-75) before editing to understand context.

    **Update docs/mcp-configuration.md**

    4 occurrences of the old URL need updating:

    Line 74: Change `cocoindex:cocoindex@localhost:5432/cocoindex` to `cocosearch:cocosearch@localhost:5432/cocosearch`
    Line 103: Change `cocoindex:cocoindex@localhost:5432/cocoindex` to `cocosearch:cocosearch@localhost:5432/cocosearch`
    Line 141: Change `cocoindex:cocoindex@localhost:5432/cocoindex` to `cocosearch:cocosearch@localhost:5432/cocosearch`
    Line 180: Change `cocoindex:cocoindex@localhost:5432/cocoindex` to `cocosearch:cocosearch@localhost:5432/cocosearch`

    Read the file first to confirm exact line numbers. The pattern is simple string replacement of `cocoindex:cocoindex@localhost:5432/cocoindex` with `cocosearch:cocosearch@localhost:5432/cocosearch` in all 4 locations.
  </action>
  <verify>
    Run: `grep -rn 'cocoindex:cocoindex' .env.example README.md docs/mcp-configuration.md`
    Expected: No output (zero occurrences remain in these files).

    Run: `grep -c 'cocosearch:cocosearch' docs/mcp-configuration.md`
    Expected: 4 occurrences.

    Run: `grep -rn 'cocoindex' .env.example README.md docs/mcp-configuration.md docker-compose.yml dev-setup.sh`
    Expected: No output. Zero references to old credentials in any non-planning file.
  </verify>
  <done>
    - .env.example updated with cocosearch credentials and marked as optional
    - README.md updated with cocosearch credentials
    - docs/mcp-configuration.md updated in all 4 locations
    - Zero references to cocoindex:cocoindex remain in any non-planning project file
  </done>
</task>

</tasks>

<verification>
1. `grep -rn 'cocoindex:cocoindex' --include='*.yml' --include='*.sh' --include='*.md' --include='*.example' . | grep -v '.planning/'` returns no results
2. `grep -c 'cocosearch' docker-compose.yml` returns 4+
3. `grep -c 'cocosearch:cocosearch' docs/mcp-configuration.md` returns 4
4. docker-compose.yml healthcheck references `cocosearch` user and database
</verification>

<success_criteria>
- INFRA-02: docker-compose.yml uses cocosearch:cocosearch credentials (POSTGRES_USER, PASSWORD, DB, healthcheck)
- All documentation files (.env.example, README.md, docs/mcp-configuration.md) reference cocosearch:cocosearch
- dev-setup.sh exports correct DATABASE_URL and notes it's now optional
- Zero references to cocoindex:cocoindex remain outside of .planning/ directory
</success_criteria>

<output>
After completion, create `.planning/phases/43-bug-fix-credential-defaults/43-02-SUMMARY.md`
</output>
