---
phase: 42-technical-documentation
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - docs/architecture.md
  - README.md
autonomous: true

must_haves:
  truths:
    - "Architecture overview explains system components (Ollama, PostgreSQL, CocoIndex, Tree-sitter)"
    - "Data flow is described end-to-end from codebase to search results"
    - "Cross-references link to retrieval.md and mcp-tools.md for details"
    - "README has a Documentation section linking to all three docs/ files"
  artifacts:
    - path: "docs/architecture.md"
      provides: "High-level system overview"
      min_lines: 80
    - path: "README.md"
      provides: "Documentation section with links to docs/"
      contains: "docs/architecture.md"
  key_links:
    - from: "docs/architecture.md"
      to: "docs/retrieval.md"
      via: "markdown link"
      pattern: "retrieval\\.md"
    - from: "docs/architecture.md"
      to: "docs/mcp-tools.md"
      via: "markdown link"
      pattern: "mcp-tools\\.md"
    - from: "README.md"
      to: "docs/"
      via: "markdown links"
      pattern: "docs/architecture\\.md"
---

<objective>
Create the architecture overview documentation and add Documentation section to README.

Purpose: Provide a high-level entry point for understanding CocoSearch's system design, with cross-references to detailed docs for retrieval logic and MCP tools.
Output: `docs/architecture.md` and updated README.md with Documentation section.
</objective>

<execution_context>
@/Users/fedorzhdanov/.claude/get-shit-done/workflows/execute-plan.md
@/Users/fedorzhdanov/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/42-technical-documentation/42-CONTEXT.md
@.planning/phases/42-technical-documentation/42-RESEARCH.md
@README.md
@src/cocosearch/indexer/flow.py
@src/cocosearch/search/query.py
@src/cocosearch/search/hybrid.py
@src/cocosearch/mcp/server.py
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create docs/architecture.md</name>
  <files>docs/architecture.md</files>
  <action>
Create `docs/` directory and write `docs/architecture.md` with the following structure:

1. **Title and introduction** (2-3 sentences): What CocoSearch is and what this doc covers.

2. **Core Concepts primer** (brief, per user decision):
   - Embeddings: 2-3 sentences explaining what embeddings are and why they matter for code search. Don't assume familiarity.
   - Vector search: 2-3 sentences on cosine similarity search against embedding vectors.
   - Reciprocal Rank Fusion (RRF): 2-3 sentences on merging ranked lists. Link to retrieval.md for formula/details.
   - No diagrams per user decision. Text descriptions only.

3. **System Components**:
   - **Ollama**: Local embedding model (nomic-embed-text), generates 768-dimension vectors. File: `src/cocosearch/indexer/embedder.py`
   - **PostgreSQL + pgvector**: Stores code chunks with vector embeddings, supports cosine similarity search and full-text search (tsvector). File: `src/cocosearch/search/db.py`
   - **CocoIndex**: Orchestrates the indexing pipeline â€” file reading, chunking, embedding generation, storage. File: `src/cocosearch/indexer/flow.py`
   - **Tree-sitter**: Language-aware code parsing for semantic chunking (31 languages). File: CocoIndex's `SplitRecursively` function
   - **FastMCP**: MCP server exposing tools to AI assistants. File: `src/cocosearch/mcp/server.py`

4. **Data Flow â€” Indexing**:
   Describe the flow briefly: Codebase files -> file filtering (gitignore, patterns) -> Tree-sitter chunking (1000 bytes, 300 overlap) -> embedding generation (Ollama nomic-embed-text) -> metadata extraction (DevOps block types, symbol info) -> tsvector preprocessing -> PostgreSQL storage with vector index.
   Say "See [Retrieval Logic](retrieval.md) for complete pipeline details."

5. **Data Flow â€” Search**:
   Describe briefly: Query -> identifier pattern detection -> embedding generation -> vector similarity search (cosine) -> optional keyword search (tsvector) -> RRF fusion -> definition boost (2x) -> symbol/language filtering -> results with context expansion.
   Say "See [Retrieval Logic](retrieval.md) for scoring formulas and caching details."

6. **MCP Integration**:
   Brief mention of 5 MCP tools (search_code, index_codebase, list_indexes, index_stats, clear_index), transport protocols (stdio, SSE, HTTP), auto-detection from working directory.
   Say "See [MCP Tools Reference](mcp-tools.md) for complete parameter documentation and examples."

7. **Key Design Decisions** (brief list):
   - Local-first: No external API calls
   - Hybrid search: Vector + keyword for better identifier matching
   - RRF fusion: Rank-based merging avoids score normalization issues
   - Definition boost: 2x multiplier for definition chunks post-fusion
   - Two-level query cache: Exact hash + semantic similarity (0.95 threshold)
   - Reference storage: Store file paths + byte offsets, not chunk text (read from source at query time)

**Style guidelines:**
- Tone: Technical but accessible â€” like a senior developer explaining the system to a new team member
- No diagrams (text descriptions only per user decision)
- Brief mentions with cross-references to detailed docs, not duplicated content
- Use consistent terminology: "chunks" (not blocks), "embeddings" (not vectors when referring to the representation), "vector search" (when referring to the search operation)
- Include file path references for key components
  </action>
  <verify>
- File `docs/architecture.md` exists and has 80+ lines
- Contains links to `retrieval.md` and `mcp-tools.md`
- Contains sections for Core Concepts, System Components, Data Flow, MCP Integration, Key Design Decisions
- No diagrams (text only)
- grep for "retrieval.md" and "mcp-tools.md" both return matches
  </verify>
  <done>Architecture overview covers all system components, both data flows, and cross-references detailed docs without duplicating their content</done>
</task>

<task type="auto">
  <name>Task 2: Add Documentation section to README.md</name>
  <files>README.md</files>
  <action>
Add a "Documentation" section to README.md. Place it after the "Architecture" section (after the mermaid diagram and Components list) and before the "Table of Contents" section.

The section content:

```markdown
## Documentation

- [Architecture Overview](docs/architecture.md) â€” System components and data flow
- [Retrieval Logic](docs/retrieval.md) â€” Hybrid search, RRF fusion, caching, and the complete indexing/search pipeline
- [MCP Tools Reference](docs/mcp-tools.md) â€” Tool parameters, return formats, and examples for AI agent integration
```

Also add a Table of Contents entry for it. Find the TOC section and add after the Architecture entry (or after an appropriate existing entry):
```
- [ðŸ“– Documentation](#documentation)
```

Place it logically â€” after the Architecture section reference in the TOC if one exists, or near the top-level sections.
  </action>
  <verify>
- grep "Documentation" README.md returns the section header and TOC entry
- grep "docs/architecture.md" README.md returns the link
- grep "docs/retrieval.md" README.md returns the link
- grep "docs/mcp-tools.md" README.md returns the link
  </verify>
  <done>README has a Documentation section with links to all three docs/ files and a corresponding TOC entry</done>
</task>

</tasks>

<verification>
1. `docs/architecture.md` exists with 80+ lines covering system overview
2. `README.md` contains Documentation section linking to all three docs/ files
3. Cross-references in architecture.md point to retrieval.md and mcp-tools.md
4. No diagrams anywhere in docs/architecture.md
5. Core concepts primer is brief (2-3 sentences each, not multi-paragraph tutorials)
</verification>

<success_criteria>
- docs/architecture.md provides a complete high-level understanding of CocoSearch's architecture
- README.md has a Documentation section that links to all three docs/ files
- Architecture doc uses cross-references instead of duplicating content from retrieval.md and mcp-tools.md
</success_criteria>

<output>
After completion, create `.planning/phases/42-technical-documentation/42-01-SUMMARY.md`
</output>
