---
phase: 42-technical-documentation
plan: 03
type: execute
wave: 1
depends_on: []
files_modified:
  - docs/mcp-tools.md
autonomous: true

must_haves:
  truths:
    - "All 5 MCP tools documented: search_code, index_codebase, list_indexes, index_stats, clear_index"
    - "Each tool has: description, parameters table, natural language example, JSON request, JSON response"
    - "Parameters show required vs optional, types, and descriptions"
    - "Examples are happy-path only with realistic data"
    - "Documentation is accurate to current implementation (post-Phase 40)"
  artifacts:
    - path: "docs/mcp-tools.md"
      provides: "Complete MCP tools reference"
      min_lines: 200
  key_links:
    - from: "docs/mcp-tools.md"
      to: "src/cocosearch/mcp/server.py"
      via: "implementation reference"
      pattern: "server\\.py"
---

<objective>
Create the MCP tools reference documentation with complete parameter descriptions and dual-format examples.

Purpose: Enable AI agents and LLMs consuming CocoSearch's MCP tools to understand all parameters, return formats, and common usage patterns.
Output: `docs/mcp-tools.md` with documentation for all 5 MCP tools.
</objective>

<execution_context>
@/Users/fedorzhdanov/.claude/get-shit-done/workflows/execute-plan.md
@/Users/fedorzhdanov/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/42-technical-documentation/42-CONTEXT.md
@.planning/phases/42-technical-documentation/42-RESEARCH.md
@src/cocosearch/mcp/server.py
@src/cocosearch/search/query.py
@src/cocosearch/management/__init__.py
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create docs/mcp-tools.md</name>
  <files>docs/mcp-tools.md</files>
  <action>
Create `docs/mcp-tools.md` with the following structure. This doc primarily targets AI agents/LLMs consuming the tools (per user decision).

**Title:** "MCP Tools Reference"
**Introduction:** 2-3 sentences. CocoSearch exposes 5 tools via the Model Context Protocol (MCP). These tools enable AI assistants to index codebases, search code semantically, and manage indexes. This reference documents each tool's parameters, return format, and provides canonical usage examples.

**Brief transport note:** Available via stdio (Claude Code, OpenCode), SSE, and streamable HTTP transports. Tool signatures are identical across all transports.

**For each of the 5 tools below, use this structure (per user decision — dual format: natural language, then JSON request, then JSON response):**

### Tool: `search_code`

**Description:** Search indexed code using natural language queries. Returns code chunks ranked by relevance, with optional hybrid search, symbol filtering, language filtering, and context expansion.

**Parameters:**

| Parameter | Type | Required | Default | Description |
|-----------|------|----------|---------|-------------|
| query | string | Yes | — | Natural language search query |
| index_name | string | No | auto-detect | Name of index to search. Auto-detects from working directory if omitted. |
| limit | integer | No | 10 | Maximum results to return |
| language | string | No | null | Filter by language (e.g., "python", "typescript", "hcl"). Comma-separated for multiple. Aliases: terraform=hcl, shell=bash, sh=bash. |
| use_hybrid_search | boolean/null | No | null (auto) | null=auto-detect from query patterns, true=force hybrid, false=vector-only |
| symbol_type | string or string[] | No | null | Filter by symbol type: "function", "class", "method", "interface". Array for OR filtering. |
| symbol_name | string | No | null | Filter by symbol name glob pattern. Examples: "get*", "User*Service", "*Handler". Case-insensitive. |
| context_before | integer | No | null | Lines of context before match. Overrides smart context. |
| context_after | integer | No | null | Lines of context after match. Overrides smart context. |
| smart_context | boolean | No | true | Expand to enclosing function/class boundaries. Set false for exact line counts only. |

**Example:**

Find authentication-related functions in Python:

**Request:**
```json
{
  "query": "user authentication and login validation",
  "language": "python",
  "symbol_type": "function",
  "limit": 5
}
```

**Response:**
```json
[
  {
    "type": "search_context",
    "searching": "/home/user/myproject",
    "index_name": "myproject"
  },
  {
    "file_path": "/home/user/myproject/src/auth/login.py",
    "start_line": 23,
    "end_line": 45,
    "score": 0.0312,
    "content": "def validate_login(username: str, password: str) -> User:\n    \"\"\"Validate user credentials and return authenticated user.\"\"\"\n    user = db.query(User).filter_by(username=username).first()\n    if not user or not verify_password(password, user.password_hash):\n        raise AuthenticationError(\"Invalid credentials\")\n    return user",
    "block_type": "",
    "hierarchy": "",
    "language_id": "",
    "symbol_type": "function",
    "symbol_name": "validate_login",
    "symbol_signature": "def validate_login(username: str, password: str) -> User",
    "context_before": "from .models import User\nfrom .security import verify_password\n",
    "context_after": "\n\ndef create_session(user: User) -> Session:",
    "match_type": "both",
    "vector_score": 0.82,
    "keyword_score": 0.45
  }
]
```

Note: The first element with `"type": "search_context"` appears when index_name was auto-detected. The `match_type` field indicates hybrid search was used ("semantic", "keyword", or "both"). A `staleness_warning` element may appear at the end if the index is older than 7 days.

---

### Tool: `index_codebase`

**Description:** Index a codebase directory for semantic search. Creates embeddings for all code files and stores them in the database. If the index already exists, updates with changes only (incremental).

**Parameters:**

| Parameter | Type | Required | Default | Description |
|-----------|------|----------|---------|-------------|
| path | string | Yes | — | Path to the codebase directory to index |
| index_name | string | No | auto-derived | Name for the index. Auto-derived from directory name if not provided. |

**Example:**

Index a Python project:

**Request:**
```json
{
  "path": "/home/user/myproject",
  "index_name": "myproject"
}
```

**Response:**
```json
{
  "success": true,
  "index_name": "myproject",
  "path": "/home/user/myproject",
  "stats": {
    "files_added": 47,
    "files_removed": 0,
    "files_updated": 0
  }
}
```

---

### Tool: `list_indexes`

**Description:** List all available code indexes. Returns index names and their backing table names.

**Parameters:** None.

**Example:**

List all indexed codebases:

**Request:**
```json
{}
```

**Response:**
```json
[
  {
    "name": "myproject",
    "table_name": "codeindex_myproject__myproject_chunks"
  },
  {
    "name": "another-repo",
    "table_name": "codeindex_another-repo__another-repo_chunks"
  }
]
```

---

### Tool: `index_stats`

**Description:** Get statistics for code indexes. Returns file count, chunk count, and storage information.

**Parameters:**

| Parameter | Type | Required | Default | Description |
|-----------|------|----------|---------|-------------|
| index_name | string | No | null | Name of index. If omitted, returns stats for all indexes. |

**Example:**

Get stats for a specific index:

**Request:**
```json
{
  "index_name": "myproject"
}
```

**Response:**
```json
{
  "index_name": "myproject",
  "file_count": 47,
  "chunk_count": 312,
  "languages": ["python", "javascript", "typescript"],
  "total_size_bytes": 245760
}
```

---

### Tool: `clear_index`

**Description:** Clear (delete) a code index. Permanently deletes all indexed data for the specified codebase. This operation cannot be undone.

**Parameters:**

| Parameter | Type | Required | Default | Description |
|-----------|------|----------|---------|-------------|
| index_name | string | Yes | — | Name of the index to delete |

**Example:**

Delete an index:

**Request:**
```json
{
  "index_name": "old-project"
}
```

**Response:**
```json
{
  "success": true,
  "message": "Index 'old-project' cleared successfully"
}
```

---

**Important implementation details to note in the doc:**
- The actual parameter names and types MUST match exactly what's in `src/cocosearch/mcp/server.py`. Read the @mcp.tool() decorated functions carefully to get exact parameter names, types, and descriptions.
- The response format for search_code must accurately reflect the output structure in server.py (the result_dict building logic).
- For the `get_stats` response, check `src/cocosearch/management/__init__.py` for the actual `get_stats()` return format.
- Use realistic but generic example data (not from any real project).
- Happy path only — no error case examples (per user decision).
- No "when to use which tool" decision guide (per user decision) — each tool's section describes its own purpose.

**Style guidelines:**
- Parameter tables with Type, Required, Default, Description columns
- JSON examples with realistic data
- Brief description before parameters, then example
- Consistent formatting across all 5 tools
- File reference at end: "Implementation: `src/cocosearch/mcp/server.py`"
  </action>
  <verify>
- File `docs/mcp-tools.md` exists with 200+ lines
- Contains all 5 tool names: search_code, index_codebase, list_indexes, index_stats, clear_index
- Each tool has a Parameters table (or "None" for list_indexes)
- Each tool has JSON Request and Response examples
- grep for "search_code" returns matches
- grep for "index_codebase" returns matches
- grep for "clear_index" returns matches
- No error case examples present
- `wc -l docs/mcp-tools.md` shows 200+ lines
  </verify>
  <done>MCP tools reference documents all 5 tools with parameter tables, natural language descriptions, and dual-format JSON examples matching the actual implementation</done>
</task>

</tasks>

<verification>
1. `docs/mcp-tools.md` exists with 200+ lines
2. All 5 MCP tools documented: search_code, index_codebase, list_indexes, index_stats, clear_index
3. Each tool has: description, parameters, natural language example description, JSON request, JSON response
4. Parameter names and types match `src/cocosearch/mcp/server.py` exactly
5. Examples are happy-path only (no error cases)
6. No "when to use which tool" decision guide
</verification>

<success_criteria>
- An AI agent can understand all available tools, their parameters, and expected responses by reading this document
- Parameter names and types are accurate to the current post-cleanup implementation
- Each tool has one clear canonical example showing the most common use case
</success_criteria>

<output>
After completion, create `.planning/phases/42-technical-documentation/42-03-SUMMARY.md`
</output>
