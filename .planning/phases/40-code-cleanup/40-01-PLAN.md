---
phase: 40-code-cleanup
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/cocosearch/indexer/languages.py
  - src/cocosearch/indexer/metadata.py
  - src/cocosearch/indexer/__init__.py
  - tests/unit/indexer/test_languages.py
  - tests/unit/indexer/test_metadata.py
  - tests/unit/indexer/test_flow.py
autonomous: true

must_haves:
  truths:
    - "Deprecated languages.py and metadata.py modules removed from codebase"
    - "Tests that imported from deprecated modules now import from handlers directly"
    - "indexer __init__.py exports from handlers not from deprecated modules"
    - "All tests pass after removal"
  artifacts:
    - path: "src/cocosearch/indexer/__init__.py"
      provides: "Package exports without deprecated module references"
      contains: "from cocosearch.handlers"
    - path: "tests/unit/indexer/test_languages.py"
      provides: "Language spec tests importing from handlers"
      contains: "from cocosearch.handlers"
    - path: "tests/unit/indexer/test_metadata.py"
      provides: "Metadata extraction tests importing from handlers"
      contains: "from cocosearch.handlers"
  key_links:
    - from: "tests/unit/indexer/test_languages.py"
      to: "cocosearch.handlers"
      via: "direct import"
      pattern: "from cocosearch\\.handlers"
    - from: "src/cocosearch/indexer/__init__.py"
      to: "cocosearch.handlers"
      via: "re-export"
      pattern: "from cocosearch\\.handlers import"
---

<objective>
Remove deprecated re-export modules (languages.py and metadata.py) and update test imports.

Purpose: These modules are backward-compatibility shims that re-export from cocosearch.handlers. Removing them simplifies the codebase and forces direct imports from the canonical source.

Output: Cleaner codebase with ~137 LOC removed (26 + 111), tests importing directly from handlers.
</objective>

<execution_context>
@/Users/fedorzhdanov/.claude/get-shit-done/workflows/execute-plan.md
@/Users/fedorzhdanov/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/40-code-cleanup/40-CONTEXT.md
@.planning/phases/40-code-cleanup/40-RESEARCH.md
@src/cocosearch/handlers/__init__.py
</context>

<tasks>

<task type="auto">
  <name>Task 1: Update test imports to use handlers directly</name>
  <files>
    tests/unit/indexer/test_languages.py
    tests/unit/indexer/test_metadata.py
    tests/unit/indexer/test_flow.py
  </files>
  <action>
Update test files to import from cocosearch.handlers instead of deprecated modules.

**test_languages.py:**
Change:
```python
from cocosearch.indexer.languages import (
    BASH_LANGUAGE,
    DEVOPS_CUSTOM_LANGUAGES,
    DOCKERFILE_LANGUAGE,
    HCL_LANGUAGE,
)
```
To:
```python
from cocosearch.handlers import get_custom_languages
from cocosearch.handlers.hcl import HclHandler
from cocosearch.handlers.dockerfile import DockerfileHandler
from cocosearch.handlers.bash import BashHandler

# Use handler constants directly
HCL_LANGUAGE = HclHandler.SEPARATOR_SPEC
DOCKERFILE_LANGUAGE = DockerfileHandler.SEPARATOR_SPEC
BASH_LANGUAGE = BashHandler.SEPARATOR_SPEC
DEVOPS_CUSTOM_LANGUAGES = get_custom_languages()
```

**test_metadata.py:**
Change imports from `cocosearch.indexer.metadata` to import from handlers:
- `DevOpsMetadata` - Create a simple dataclass locally or inline the dict usage
- `extract_hcl_metadata`, `extract_dockerfile_metadata`, `extract_bash_metadata` - Use handler.extract_metadata() directly
- `_strip_leading_comments`, `_HCL_COMMENT_LINE`, etc. - These are private internals; access via handler attributes
- `_LANGUAGE_DISPATCH`, `_LANGUAGE_ID_MAP`, `_EMPTY_METADATA` - Recreate locally for test purposes

For test_metadata.py, since it tests the deprecated module's interface, the best approach is:
1. Create local test helpers that mirror the old interface
2. Import directly from handlers:
```python
from cocosearch.handlers.hcl import HclHandler
from cocosearch.handlers.dockerfile import DockerfileHandler
from cocosearch.handlers.bash import BashHandler
```

**test_flow.py (line 225 area):**
Change:
```python
from cocosearch.indexer.languages import DEVOPS_CUSTOM_LANGUAGES
```
To:
```python
from cocosearch.handlers import get_custom_languages
DEVOPS_CUSTOM_LANGUAGES = get_custom_languages()
```
  </action>
  <verify>
Run: `uv run pytest tests/unit/indexer/test_languages.py tests/unit/indexer/test_metadata.py tests/unit/indexer/test_flow.py -v`
All tests pass.
  </verify>
  <done>
Tests import from cocosearch.handlers (not deprecated modules) and all pass.
  </done>
</task>

<task type="auto">
  <name>Task 2: Update indexer __init__.py and remove deprecated modules</name>
  <files>
    src/cocosearch/indexer/__init__.py
    src/cocosearch/indexer/languages.py
    src/cocosearch/indexer/metadata.py
  </files>
  <action>
**Step 1: Update indexer __init__.py**

Change line 5:
```python
from cocosearch.indexer.metadata import DevOpsMetadata, extract_devops_metadata
```
To:
```python
from cocosearch.handlers import extract_devops_metadata
```

Note: DevOpsMetadata is no longer exported (it was a backward-compat wrapper). If any code needs it, they can create their own dataclass or use dicts.

Remove DevOpsMetadata from __all__ list.

**Step 2: Delete deprecated modules**

Delete:
- `src/cocosearch/indexer/languages.py` (26 lines)
- `src/cocosearch/indexer/metadata.py` (111 lines)

**Step 3: Verify no remaining imports**

Run grep to confirm no other files import from these modules:
```bash
grep -r "from cocosearch.indexer.languages import" src/ tests/ --include="*.py"
grep -r "from cocosearch.indexer.metadata import" src/ tests/ --include="*.py"
```

Both should return no results (excluding the files we just updated).
  </action>
  <verify>
Run: `uv run pytest tests/unit/indexer/ -v && uv run ruff check src/cocosearch/indexer/`
All tests pass and no lint errors (unused imports, etc.).
  </verify>
  <done>
languages.py and metadata.py deleted, __init__.py updated, no import errors.
  </done>
</task>

<task type="auto">
  <name>Task 3: Run full test suite and record LOC reduction</name>
  <files>
    (verification only - no file changes)
  </files>
  <action>
**Step 1: Run full test suite**
```bash
uv run pytest
```

**Step 2: Run linters**
```bash
uv run ruff check src/
uv run mypy src/ --ignore-missing-imports
```

**Step 3: Record LOC reduction**
```bash
find src -name "*.py" | xargs wc -l | tail -1
```

Compare against baseline of 9,274 lines. Expected reduction: ~137 lines (26 + 111).

**Step 4: Commit changes**
```bash
git add -A
git commit -m "refactor(40-01): remove deprecated languages.py and metadata.py modules

- Delete src/cocosearch/indexer/languages.py (26 lines)
- Delete src/cocosearch/indexer/metadata.py (111 lines)
- Update tests to import from cocosearch.handlers directly
- Update indexer __init__.py to export from handlers

LOC reduction: 137 lines
Resolves: CLEAN-02 (remove deprecated functions)

Co-Authored-By: Claude Opus 4.5 <noreply@anthropic.com>"
```
  </action>
  <verify>
`uv run pytest` passes (all tests green).
`find src -name "*.py" | xargs wc -l | tail -1` shows reduction from 9,274.
Git commit created.
  </verify>
  <done>
Full test suite passes, LOC reduced by ~137 lines, commit created.
  </done>
</task>

</tasks>

<verification>
After all tasks:
1. `grep -r "cocosearch.indexer.languages" src/ tests/` returns no results
2. `grep -r "cocosearch.indexer.metadata" src/ tests/` returns no results (except possibly .planning docs)
3. `ls src/cocosearch/indexer/languages.py` returns "No such file"
4. `ls src/cocosearch/indexer/metadata.py` returns "No such file"
5. `uv run pytest` all green
6. `uv run ruff check src/` no errors
</verification>

<success_criteria>
- languages.py and metadata.py deleted from src/cocosearch/indexer/
- All test files import from cocosearch.handlers instead
- indexer __init__.py exports from handlers
- Full test suite passes
- No ruff/mypy errors
- LOC count reduced by ~137 lines
- Git commit created with proper message
</success_criteria>

<output>
After completion, create `.planning/phases/40-code-cleanup/40-01-SUMMARY.md`
</output>
