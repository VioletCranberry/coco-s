---
phase: 44-docker-image-simplification
plan: 02
type: execute
wave: 2
depends_on: ["44-01"]
files_modified:
  - README.md
  - docs/mcp-configuration.md
autonomous: true

must_haves:
  truths:
    - "README Getting Started describes infra-only Docker image (no MCP server inside container)"
    - "README Option #1 shows ports 5432 and 11434 only (not 3000)"
    - "README explains users run CocoSearch natively via uvx after starting Docker infrastructure"
    - "MCP configuration docs mention Docker provides infrastructure while uvx runs the MCP server"
  artifacts:
    - path: "README.md"
      provides: "Updated Getting Started with infra-only Docker model"
      contains: "infrastructure"
    - path: "docs/mcp-configuration.md"
      provides: "MCP configuration with Docker infrastructure note"
      contains: "docker compose"
  key_links:
    - from: "README.md"
      to: "docs/mcp-configuration.md"
      via: "See mcp-configuration link"
      pattern: "mcp-configuration"
---

<objective>
Update README.md and docs/mcp-configuration.md to reflect the new infra-only Docker model. Option #1 in the README currently describes an all-in-one image with an MCP server; it must describe the infra-only image that provides PostgreSQL+Ollama while users run CocoSearch natively.

Purpose: Users need accurate documentation to set up the new deployment model (Docker for infra, uvx for CocoSearch).
Output: Updated README.md Getting Started section and MCP configuration docs with Docker infrastructure context.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/44-docker-image-simplification/44-RESEARCH.md
@.planning/phases/44-docker-image-simplification/44-01-SUMMARY.md
@README.md
@docs/mcp-configuration.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Update README Getting Started for infra-only Docker model</name>
  <files>README.md</files>
  <action>
  Rewrite the Getting Started section of README.md. Only modify Option #1 and Option #2 text. Do NOT change anything outside the Getting Started section (Features, Supported Languages, Components, Configuring MCP, Configuration File sections remain untouched).

  **Option #1** (currently "all-in-one Docker image") — rewrite to describe the infra-only Docker image:
  - Title: Change from "all-in-one Docker image bundles PostgreSQL (with pgvector), Ollama (with pre-baked nomic-embed-text model), and the CocoSearch MCP server" to: "The Docker image bundles PostgreSQL (with pgvector) and Ollama (with pre-baked nomic-embed-text model) as infrastructure services. CocoSearch runs natively."
  - Build command stays the same: `docker build -t cocosearch -f docker/Dockerfile .`
  - Run command changes: `docker run -v cocosearch-data:/data -p 5432:5432 -p 11434:11434 cocosearch` (remove -p 3000:3000, remove -v /path/to/code:/mnt/repos:ro)
  - Add after the run command: a brief note that CocoSearch is installed and run natively:
    ```bash
    # Install and run CocoSearch natively
    uvx --from git+https://github.com/VioletCranberry/coco-s cocosearch --help
    ```
  - Remove "No separate setup required" (there IS separate setup — running CocoSearch natively)

  **Option #2** (docker compose) — minor updates only:
  - Remove the comment line `# PostgreSQL connection URL (optional, this is the default when using docker compose).` and the `export COCOSEARCH_DATABASE_URL=...` line. These are already defaults as of Phase 43 and should not be shown as required steps.
  - Keep the `docker compose up -d` command and its description.
  - Keep the `export COCOSEARCH_OLLAMA_URL=...` line (Ollama URL is not defaulted).
  - After the docker compose block, add a similar note about installing CocoSearch natively (same uvx command as Option #1).

  **Option #3** stays unchanged.

  **Important:** Preserve the exact formatting style of the existing README. Keep the same markdown patterns (bold for Option labels, code blocks for commands, comments inside code blocks for explanations).
  </action>
  <verify>
  1. Run `grep "3000" README.md` — must return nothing (no port 3000 references)
  2. Run `grep "all-in-one" README.md` — must return nothing
  3. Run `grep "MCP server" README.md` — must NOT appear in the Getting Started / Option #1 context (it can appear in the Configuring MCP section)
  4. Run `grep "5432:5432" README.md` — must return a match in Option #1
  5. Run `grep "11434:11434" README.md` — must return a match in Option #1
  6. Run `grep "uvx" README.md` — must return matches showing native install command
  7. Run `grep "infrastructure" README.md` — must return a match in the Getting Started section
  </verify>
  <done>
  README Option #1 describes the infra-only Docker image exposing only ports 5432 and 11434. Users are directed to install CocoSearch natively via uvx. Option #2 is simplified (no redundant DATABASE_URL export). No references to port 3000 or "all-in-one" anywhere in the file.
  </done>
</task>

<task type="auto">
  <name>Task 2: Add Docker infrastructure context to MCP configuration docs</name>
  <files>docs/mcp-configuration.md</files>
  <action>
  Add a brief "Prerequisites" section at the top of docs/mcp-configuration.md (after the opening description, before "Available MCP tools"). This section explains that CocoSearch needs PostgreSQL+pgvector and Ollama running, and the simplest way is Docker:

  ```markdown
  ### Prerequisites

  CocoSearch requires PostgreSQL (with pgvector) and Ollama running locally. The simplest setup:

  ```bash
  # Option A: Docker Compose (recommended)
  docker compose up -d

  # Option B: All-in-one Docker image
  docker build -t cocosearch -f docker/Dockerfile .
  docker run -v cocosearch-data:/data -p 5432:5432 -p 11434:11434 cocosearch
  ```

  With infrastructure running, configure your MCP client below. The database connection defaults to `postgresql://cocosearch:cocosearch@localhost:5432/cocosearch` — no environment variables needed when using Docker.
  ```

  Also, in the "Per-Project Registration" section and the per-client configuration sections that show `COCOSEARCH_DATABASE_URL=postgresql://cocosearch:cocosearch@localhost:5432/cocosearch` in env vars — add a brief comment noting this env var is optional when using Docker (it matches the default). Do NOT remove the env var from examples (it's useful for clarity), just add a note. Example: add a line after the env block like:
  `> **Note:** The `COCOSEARCH_DATABASE_URL` above matches the default when using Docker. You can omit it if using docker compose or the all-in-one image.`

  Do NOT change the Single Registration section (it doesn't reference DATABASE_URL).
  Do NOT change the command structures or uvx patterns.
  </action>
  <verify>
  1. Run `grep "Prerequisites" docs/mcp-configuration.md` — must return a match
  2. Run `grep "docker compose" docs/mcp-configuration.md` — must return a match
  3. Run `grep "5432:5432" docs/mcp-configuration.md` — must return a match in Prerequisites
  4. Run `grep "optional" docs/mcp-configuration.md` — must return a match (note about optional env var)
  5. Verify the Single Registration section is unchanged (grep for "Single Registration" and "--project-from-cwd" still present)
  </verify>
  <done>
  MCP configuration docs have a Prerequisites section explaining Docker infrastructure setup. Per-client sections note that DATABASE_URL env var is optional with Docker. The document is self-contained — users can set up both infrastructure and MCP client from this single page.
  </done>
</task>

</tasks>

<verification>
After both tasks complete, verify documentation accuracy:

1. README Option #1 describes infra-only Docker image with ports 5432 and 11434 only
2. README includes uvx install command for native CocoSearch
3. docs/mcp-configuration.md has Prerequisites section with Docker setup
4. No references to port 3000 in Getting Started section of README
5. No references to "all-in-one" in README
6. MCP docs note DATABASE_URL is optional with Docker
</verification>

<success_criteria>
- README Getting Started accurately reflects the infra-only Docker model
- Users can follow documentation to: (1) start Docker infrastructure, (2) install CocoSearch natively, (3) register MCP server
- docs/mcp-configuration.md is self-contained with infrastructure prerequisites
- No stale references to MCP server running inside Docker container
</success_criteria>

<output>
After completion, create `.planning/phases/44-docker-image-simplification/44-02-SUMMARY.md`
</output>
