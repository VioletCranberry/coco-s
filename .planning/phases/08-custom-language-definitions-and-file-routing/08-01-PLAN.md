---
phase: 08-custom-language-definitions-and-file-routing
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/cocosearch/indexer/languages.py
  - src/cocosearch/indexer/config.py
  - tests/indexer/test_languages.py
  - tests/indexer/test_config.py
autonomous: true

must_haves:
  truths:
    - "HCL CustomLanguageSpec defines separators that split at top-level block boundaries"
    - "Dockerfile CustomLanguageSpec defines separators that split at FROM and instruction boundaries"
    - "Bash CustomLanguageSpec defines separators that split at function and section boundaries"
    - "All separator patterns use standard Rust regex only (no lookaheads)"
    - "DevOps file patterns are included in IndexingConfig defaults"
  artifacts:
    - path: "src/cocosearch/indexer/languages.py"
      provides: "CustomLanguageSpec definitions for HCL, Dockerfile, Bash"
      exports: ["HCL_LANGUAGE", "DOCKERFILE_LANGUAGE", "BASH_LANGUAGE", "DEVOPS_CUSTOM_LANGUAGES"]
    - path: "src/cocosearch/indexer/config.py"
      provides: "Updated include_patterns with DevOps file patterns"
      contains: "*.tf"
    - path: "tests/indexer/test_languages.py"
      provides: "Unit tests for language spec definitions"
      min_lines: 40
  key_links:
    - from: "src/cocosearch/indexer/languages.py"
      to: "cocoindex.functions.CustomLanguageSpec"
      via: "import and construction"
      pattern: "CustomLanguageSpec"
---

<objective>
Create the three CustomLanguageSpec definitions (HCL, Dockerfile, Bash) and add DevOps file patterns to IndexingConfig.

Purpose: This is the foundation for Phase 08. Without correct language specs and file patterns, DevOps files either won't be picked up for indexing or will be chunked as plain text instead of at structural boundaries.

Output: `languages.py` module with three CustomLanguageSpec constants and an aggregated list, updated `config.py` with DevOps include_patterns, and comprehensive unit tests.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/08-custom-language-definitions-and-file-routing/08-RESEARCH.md
@src/cocosearch/indexer/config.py
@src/cocosearch/indexer/embedder.py
@src/cocosearch/indexer/__init__.py
@tests/indexer/test_config.py
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create languages.py with CustomLanguageSpec definitions</name>
  <files>src/cocosearch/indexer/languages.py, tests/indexer/test_languages.py</files>
  <action>
Create `src/cocosearch/indexer/languages.py` with three module-level `CustomLanguageSpec` constants and one aggregated list:

1. **HCL_LANGUAGE** (`language_name="hcl"`, `aliases=["tf", "tfvars"]`):
   - Level 1 separator: `r"\n(?:resource|data|variable|output|locals|module|provider|terraform|import|moved|removed|check) "` -- top-level block boundaries
   - Level 2 separator: `r"\n\n+"` -- blank lines between sections
   - Level 3 separator: `r"\n"` -- single newlines
   - Level 4 separator: `r" "` -- whitespace (last resort)
   Note: Do NOT include "hcl" in aliases -- it matches `language_name` directly. Only `tf` and `tfvars` need aliases.

2. **DOCKERFILE_LANGUAGE** (`language_name="dockerfile"`, `aliases=[]`):
   - Level 1 separator: `r"\nFROM "` -- build stage boundaries
   - Level 2 separator: `r"\n(?:RUN|COPY|ADD|ENV|EXPOSE|VOLUME|WORKDIR|USER|LABEL|ARG|ENTRYPOINT|CMD|HEALTHCHECK|SHELL|ONBUILD|STOPSIGNAL|MAINTAINER) "` -- major instructions
   - Level 3 separator: `r"\n\n+"` -- blank lines
   - Level 4 separator: `r"\n# "` -- comment lines
   - Level 5 separator: `r"\n"` -- single newlines
   - Level 6 separator: `r" "` -- whitespace
   No aliases needed -- the `extract_language` function (Plan 02) returns "dockerfile" directly.

3. **BASH_LANGUAGE** (`language_name="bash"`, `aliases=["sh", "zsh", "shell"]`):
   - Level 1 separator: `r"\nfunction "` -- function keyword definitions
   - Level 2 separator: `r"\n\n+"` -- blank lines (logical section separators)
   - Level 3 separator: `r"\n#+"` -- comment section headers
   - Level 4 separator: `r"\n(?:if |for |while |case |until )"` -- control flow keywords
   - Level 5 separator: `r"\n"` -- single newlines
   - Level 6 separator: `r" "` -- whitespace

4. **DEVOPS_CUSTOM_LANGUAGES** = `[HCL_LANGUAGE, DOCKERFILE_LANGUAGE, BASH_LANGUAGE]`

CRITICAL: ALL separator patterns must use standard Rust regex syntax only. NO lookaheads (`(?=...)`), NO lookbehinds (`(?<=...)`), NO backreferences (`\1`). CocoIndex uses standard Rust `regex` v1.12.2 (verified in 08-RESEARCH.md). Non-capturing groups `(?:...)` and alternation `|` ARE supported.

Import: `import cocoindex` (for `cocoindex.functions.CustomLanguageSpec`)

Add a module docstring explaining this is for DevOps language-aware chunking and that patterns use standard Rust regex.

Create `tests/indexer/test_languages.py` with tests that verify:
- Each language spec has the correct `language_name`
- Each language spec has the correct `aliases`
- Each language spec has a non-empty `separators_regex` list
- `DEVOPS_CUSTOM_LANGUAGES` contains all three specs
- NO separator pattern contains `(?=` or `(?<=` (lookahead/lookbehind guard test)
- HCL separators include all 12 top-level block keywords in the Level 1 pattern (resource, data, variable, output, locals, module, provider, terraform, import, moved, removed, check)
- Dockerfile separators include FROM as a separate (higher priority) separator from other instructions

Follow the existing test style in `tests/indexer/test_config.py` (class-based, descriptive method names, `from cocosearch.indexer.languages import ...`).
  </action>
  <verify>
Run: `cd /Users/fzhdanov/GIT/personal/coco-s && python -m pytest tests/indexer/test_languages.py -v`
All tests pass. Also verify the module imports cleanly: `python -c "from cocosearch.indexer.languages import DEVOPS_CUSTOM_LANGUAGES; print(len(DEVOPS_CUSTOM_LANGUAGES))"` prints `3`.
  </verify>
  <done>
languages.py exists with three CustomLanguageSpec constants (HCL_LANGUAGE, DOCKERFILE_LANGUAGE, BASH_LANGUAGE) and DEVOPS_CUSTOM_LANGUAGES list. All separator patterns use standard Rust regex only (no lookaheads). All tests pass.
  </done>
</task>

<task type="auto">
  <name>Task 2: Add DevOps file patterns to IndexingConfig</name>
  <files>src/cocosearch/indexer/config.py, tests/indexer/test_config.py</files>
  <action>
Modify `src/cocosearch/indexer/config.py`:

Add DevOps file patterns to the `include_patterns` default list in `IndexingConfig`. Add them as a clearly separated group at the end of the existing list (after the `*.yml` entry), with a comment `# DevOps files`:

```python
# DevOps files (HCL/Terraform)
"*.tf",
"*.hcl",
"*.tfvars",
# DevOps files (Dockerfile)
"Dockerfile",
"Dockerfile.*",
"Containerfile",
# DevOps files (Bash/Shell)
"*.sh",
"*.bash",
```

Note: `Dockerfile` and `Dockerfile.*` and `Containerfile` are needed for extensionless and variant Dockerfile names. These may need `**/` prefix if CocoIndex's `included_patterns` requires glob-style paths. Research confidence on bare filenames is LOW (08-RESEARCH.md, Pitfall 6). Start with bare names; if validation fails in Plan 02, add `**/` prefix.

Do NOT change `chunk_size` or `chunk_overlap` defaults yet -- that will be addressed when the flow is wired in Plan 02 (chunk_size=2000 recommendation from research is for the flow call, not the config default).

Update `tests/indexer/test_config.py`:

Add a new test class `TestDevOpsPatterns` (or add tests to existing `TestIndexingConfig`) that verify:
- `*.tf` is in include_patterns
- `*.hcl` is in include_patterns
- `*.tfvars` is in include_patterns
- `Dockerfile` is in include_patterns
- `Dockerfile.*` is in include_patterns
- `Containerfile` is in include_patterns
- `*.sh` is in include_patterns
- `*.bash` is in include_patterns
- All previously existing patterns (e.g., `*.py`, `*.js`, `*.go`) are still present (regression check)
  </action>
  <verify>
Run: `cd /Users/fzhdanov/GIT/personal/coco-s && python -m pytest tests/indexer/test_config.py -v`
All tests pass, including both old and new tests.
  </verify>
  <done>
config.py include_patterns contains all 8 DevOps file patterns. Existing patterns unchanged. All config tests pass.
  </done>
</task>

</tasks>

<verification>
1. `python -m pytest tests/indexer/test_languages.py tests/indexer/test_config.py -v` -- all tests pass
2. `python -c "from cocosearch.indexer.languages import DEVOPS_CUSTOM_LANGUAGES; print(len(DEVOPS_CUSTOM_LANGUAGES))"` -- prints 3
3. `python -c "from cocosearch.indexer.config import IndexingConfig; c = IndexingConfig(); assert '*.tf' in c.include_patterns; assert '*.py' in c.include_patterns; print('OK')"` -- prints OK
4. No separator pattern contains `(?=` substring (verified by test)
</verification>

<success_criteria>
- languages.py exports HCL_LANGUAGE, DOCKERFILE_LANGUAGE, BASH_LANGUAGE, DEVOPS_CUSTOM_LANGUAGES
- All separator patterns are valid standard Rust regex (no lookaheads/lookbehinds)
- HCL spec covers all 12 top-level block keywords
- Dockerfile spec separates FROM at higher priority than other instructions
- Bash spec captures function keyword at highest priority
- config.py includes all 8 DevOps file patterns alongside existing patterns
- All existing tests continue to pass (no regressions)
- New tests cover language specs and DevOps patterns comprehensively
</success_criteria>

<output>
After completion, create `.planning/phases/08-custom-language-definitions-and-file-routing/08-01-SUMMARY.md`
</output>
