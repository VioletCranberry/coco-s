---
phase: 20-env-var-standardization
plan: 04
type: execute
wave: 2
depends_on: ["20-01", "20-02"]
files_modified:
  - .env.example
  - dev-setup.sh
  - README.md
  - CHANGELOG.md
autonomous: true

must_haves:
  truths:
    - "User sees COCOSEARCH_* prefixed env vars in .env.example"
    - "User finds COCOSEARCH_* naming in all documentation"
    - "dev-setup.sh uses COCOSEARCH_* vars"
    - "CHANGELOG documents migration from old to new var names"
  artifacts:
    - path: ".env.example"
      provides: "Example environment configuration with COCOSEARCH_* vars"
      contains: "COCOSEARCH_DATABASE_URL"
    - path: "dev-setup.sh"
      provides: "Developer setup script with COCOSEARCH_* vars"
      contains: "COCOSEARCH_DATABASE_URL"
    - path: "README.md"
      provides: "Documentation with COCOSEARCH_* env vars"
      contains: "COCOSEARCH_DATABASE_URL"
    - path: "CHANGELOG.md"
      provides: "Migration documentation with old to new mapping"
      contains: "COCOINDEX_DATABASE_URL"
  key_links:
    - from: "CHANGELOG.md"
      to: "migration table"
      via: "documents old -> new mapping"
      pattern: "COCOINDEX_DATABASE_URL.*COCOSEARCH_DATABASE_URL"
---

<objective>
Update all documentation and configuration files to use standardized COCOSEARCH_* environment variable names. Create CHANGELOG.md documenting the migration.

Purpose: Ensure users can easily find and use the new environment variable names, with clear migration guidance.

Output: Updated .env.example, dev-setup.sh, README.md, and new CHANGELOG.md with migration table.
</objective>

<execution_context>
@/Users/fedorzhdanov/.claude/get-shit-done/workflows/execute-plan.md
@/Users/fedorzhdanov/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/20-env-var-standardization/20-CONTEXT.md
@.env.example
@dev-setup.sh
@README.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Update .env.example</name>
  <files>.env.example</files>
  <action>
Replace the entire .env.example file with:

```
# CocoSearch environment configuration template
# Copy this file to .env and adjust values as needed

# =============================================================================
# Required
# =============================================================================

# PostgreSQL connection URL for vector storage
# Format: postgresql://user:password@host:port/database
COCOSEARCH_DATABASE_URL=postgresql://cocoindex:cocoindex@localhost:5432/cocoindex

# =============================================================================
# Optional (uncomment to override defaults)
# =============================================================================

# Ollama API URL for embeddings
# Default: http://localhost:11434
# COCOSEARCH_OLLAMA_URL=http://localhost:11434
```

Key changes:
- COCOINDEX_DATABASE_URL -> COCOSEARCH_DATABASE_URL
- Add COCOSEARCH_OLLAMA_URL as commented optional
- Organized into Required and Optional sections
- Clear comments explaining each variable
  </action>
  <verify>
    grep "COCOSEARCH_DATABASE_URL" .env.example
    grep "COCOSEARCH_OLLAMA_URL" .env.example
    grep "COCOINDEX" .env.example || echo "No old refs - good"
  </verify>
  <done>
    - .env.example uses COCOSEARCH_DATABASE_URL
    - .env.example includes commented COCOSEARCH_OLLAMA_URL
    - No COCOINDEX_ references remain
    - File has clear section organization
  </done>
</task>

<task type="auto">
  <name>Task 2: Update dev-setup.sh</name>
  <files>dev-setup.sh</files>
  <action>
In dev-setup.sh, make these changes:

1. Line 9: Change the export statement:
   - FROM: `export COCOINDEX_DATABASE_URL="postgresql://cocoindex:cocoindex@localhost:5432/cocoindex"`
   - TO: `export COCOSEARCH_DATABASE_URL="postgresql://cocoindex:cocoindex@localhost:5432/cocoindex"`

2. Line 117 (in show_next_steps function): Update the echo statement:
   - FROM: `echo "  export COCOINDEX_DATABASE_URL=\"postgresql://cocoindex:cocoindex@localhost:5432/cocoindex\""`
   - TO: `echo "  export COCOSEARCH_DATABASE_URL=\"postgresql://cocoindex:cocoindex@localhost:5432/cocoindex\""`
  </action>
  <verify>
    grep "COCOSEARCH_DATABASE_URL" dev-setup.sh
    grep "COCOINDEX_DATABASE_URL" dev-setup.sh || echo "No old refs - good"
  </verify>
  <done>
    - dev-setup.sh exports COCOSEARCH_DATABASE_URL
    - Instructions show COCOSEARCH_DATABASE_URL
    - No COCOINDEX_ references remain
  </done>
</task>

<task type="auto">
  <name>Task 3: Update README.md</name>
  <files>README.md</files>
  <action>
In README.md, perform a global find-and-replace for environment variables:

1. Replace all `COCOINDEX_DATABASE_URL` with `COCOSEARCH_DATABASE_URL`

2. Replace all `OLLAMA_HOST` with `COCOSEARCH_OLLAMA_URL` (keep the same default value http://localhost:11434)

This affects multiple sections:
- Installation section (around line 265)
- MCP Configuration (Claude Code CLI command, around line 288)
- All JSON config examples (Claude Code, Claude Desktop, OpenCode - lines 317, 355, 394)
- Environment Variables table (lines 582-583)

The Environment Variables table should become:
```markdown
| Variable                   | Description                | Default                                                     |
| -------------------------- | -------------------------- | ----------------------------------------------------------- |
| `COCOSEARCH_DATABASE_URL`  | PostgreSQL connection URL  | `postgresql://cocoindex:cocoindex@localhost:5432/cocoindex` |
| `COCOSEARCH_OLLAMA_URL`    | Ollama API URL             | `http://localhost:11434`                                    |
```

Note: Also update the description from "Ollama API host" to "Ollama API URL" for consistency.
  </action>
  <verify>
    grep -c "COCOSEARCH_DATABASE_URL" README.md
    grep -c "COCOSEARCH_OLLAMA_URL" README.md
    grep "COCOINDEX_DATABASE_URL\|OLLAMA_HOST" README.md || echo "No old refs - good"
  </verify>
  <done>
    - All COCOINDEX_DATABASE_URL replaced with COCOSEARCH_DATABASE_URL
    - All OLLAMA_HOST replaced with COCOSEARCH_OLLAMA_URL
    - Environment Variables table updated
    - All MCP config examples updated
  </done>
</task>

<task type="auto">
  <name>Task 4: Create CHANGELOG.md</name>
  <files>CHANGELOG.md</files>
  <action>
Create a new CHANGELOG.md file at the repository root with:

```markdown
# Changelog

All notable changes to CocoSearch will be documented in this file.

The format is based on [Keep a Changelog](https://keepachangelog.com/en/1.0.0/).

## [Unreleased]

### Changed

- **BREAKING:** Environment variables renamed for consistency ([Phase 20](/.planning/phases/20-env-var-standardization/))

  | Old Name                 | New Name                  | Notes                     |
  |--------------------------|---------------------------|---------------------------|
  | `COCOINDEX_DATABASE_URL` | `COCOSEARCH_DATABASE_URL` | Required - database URL   |
  | `OLLAMA_HOST`            | `COCOSEARCH_OLLAMA_URL`   | Optional - Ollama API URL |

  **Migration:** Update your environment configuration to use the new variable names. The old names are no longer recognized.

### Added

- `cocosearch config check` command to validate environment variables without connecting to services
```

Key points:
- Documents the breaking change clearly
- Provides complete mapping table
- References the phase for context
- Notes the new config check command
  </action>
  <verify>
    test -f CHANGELOG.md && echo "CHANGELOG.md exists"
    grep "COCOINDEX_DATABASE_URL" CHANGELOG.md && echo "Old name documented"
    grep "COCOSEARCH_DATABASE_URL" CHANGELOG.md && echo "New name documented"
  </verify>
  <done>
    - CHANGELOG.md created at repository root
    - Migration table documents old -> new mapping
    - Breaking change clearly marked
    - New config check command documented
  </done>
</task>

</tasks>

<verification>
Run all verification commands:
```bash
# 1. Check .env.example
grep "COCOSEARCH" .env.example | wc -l
# Expected: 2 (DATABASE_URL and OLLAMA_URL)

# 2. Check dev-setup.sh
grep -c "COCOSEARCH_DATABASE_URL" dev-setup.sh
# Expected: 2

# 3. Check README.md has no old refs
grep "COCOINDEX_DATABASE_URL\|OLLAMA_HOST" README.md || echo "README clean"

# 4. Check CHANGELOG exists with migration table
grep -A5 "Old Name" CHANGELOG.md

# 5. Verify no old env var names in documentation files
grep -r "COCOINDEX_DATABASE_URL" .env.example dev-setup.sh README.md || echo "All docs clean"
grep -r "OLLAMA_HOST" .env.example dev-setup.sh README.md || echo "All docs clean"
```
</verification>

<success_criteria>
1. .env.example uses COCOSEARCH_* variables
2. dev-setup.sh uses COCOSEARCH_DATABASE_URL throughout
3. README.md uses COCOSEARCH_* in all locations
4. CHANGELOG.md exists with migration table
5. No references to COCOINDEX_DATABASE_URL or OLLAMA_HOST in any documentation files
</success_criteria>

<output>
After completion, create `.planning/phases/20-env-var-standardization/20-04-SUMMARY.md`
</output>
