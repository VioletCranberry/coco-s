# Requirements Archive: v1.6 All-in-One Docker & Auto-Detect

**Archived:** 2026-02-02
**Status:** SHIPPED

This is the archived requirements specification for v1.6.
For current requirements, see `.planning/REQUIREMENTS.md` (created for next milestone).

---

# Requirements: CocoSearch v1.6

**Defined:** 2026-02-01
**Core Value:** Semantic code search that runs entirely locally -- no data leaves your machine

## v1.6 Requirements

Requirements for All-in-One Docker & Auto-Detect milestone.

### Container Deployment

- [x] **DOCK-01**: User can run entire stack with single `docker run` command
- [x] **DOCK-02**: Docker image includes pre-pulled nomic-embed-text model (no runtime download)
- [x] **DOCK-03**: User can mount codebases via volume (`-v /local/repos:/mnt/repos:ro`)
- [x] **DOCK-04**: User can persist data across restarts via volume (`-v cocosearch-data:/data`)
- [x] **DOCK-05**: User can configure via existing COCOSEARCH_* environment variables
- [x] **DOCK-06**: User can view logs via `docker logs` (stdout/stderr)

### Service Orchestration

- [x] **ORCH-01**: Container exposes health check endpoint (`/health`) returning 200 when ready
- [x] **ORCH-02**: Services start in correct order (PostgreSQL -> Ollama -> MCP server)
- [x] **ORCH-03**: Container shuts down gracefully on SIGTERM (no data corruption)
- [x] **ORCH-04**: Process supervisor (s6-overlay) manages and restarts crashed services

### MCP Transports

- [x] **TRNS-01**: stdio transport works in container for Claude Code (`docker run -i`)
- [x] **TRNS-02**: SSE transport available for Claude Desktop (`--transport sse`)
- [x] **TRNS-03**: Streamable HTTP transport available as future standard (`--transport http`)
- [x] **TRNS-04**: Transport selectable via `--transport` flag or `MCP_TRANSPORT` env var

### Auto-Detect Project

- [x] **AUTO-01**: MCP can auto-detect project from working directory
- [x] **AUTO-02**: Detection priority: cocosearch.yaml `indexName` > git repo name > directory name
- [x] **AUTO-03**: System detects collision when same index name maps to different paths
- [x] **AUTO-04**: On collision, user prompted to set explicit `indexName` in cocosearch.yaml
- [x] **AUTO-05**: When auto-detected index doesn't exist, user prompted to run index command
- [x] **AUTO-06**: cocosearch.yaml supports `indexName` field for explicit naming

### Documentation

- [x] **DOCS-01**: Docker quick start guide with pull/run examples
- [x] **DOCS-02**: Claude Code Docker configuration example (stdio transport)
- [x] **DOCS-03**: Claude Desktop Docker configuration example (SSE/HTTP transport)
- [x] **DOCS-04**: Volume mount and persistence documentation
- [x] **DOCS-05**: Troubleshooting guide for common Docker issues

## Traceability

| Requirement | Phase | Status |
|-------------|-------|--------|
| TRNS-01 | Phase 23 | Complete |
| TRNS-02 | Phase 23 | Complete |
| TRNS-03 | Phase 23 | Complete |
| TRNS-04 | Phase 23 | Complete |
| DOCK-01 | Phase 24 | Complete |
| DOCK-02 | Phase 24 | Complete |
| DOCK-03 | Phase 24 | Complete |
| DOCK-04 | Phase 24 | Complete |
| DOCK-05 | Phase 24 | Complete |
| DOCK-06 | Phase 24 | Complete |
| ORCH-01 | Phase 24 | Complete |
| ORCH-02 | Phase 24 | Complete |
| ORCH-03 | Phase 24 | Complete |
| ORCH-04 | Phase 24 | Complete |
| AUTO-01 | Phase 25 | Complete |
| AUTO-02 | Phase 25 | Complete |
| AUTO-03 | Phase 25 | Complete |
| AUTO-04 | Phase 25 | Complete |
| AUTO-05 | Phase 25 | Complete |
| AUTO-06 | Phase 25 | Complete |
| DOCS-01 | Phase 26 | Complete |
| DOCS-02 | Phase 26 | Complete |
| DOCS-03 | Phase 26 | Complete |
| DOCS-04 | Phase 26 | Complete |
| DOCS-05 | Phase 26 | Complete |

**Coverage:**
- v1.6 requirements: 25 total
- Shipped: 25
- Unmapped: 0

---

## Milestone Summary

**Shipped:** 25 of 25 v1.6 requirements
**Adjusted:** None
**Dropped:** None

---
*Archived: 2026-02-02 as part of v1.6 milestone completion*
